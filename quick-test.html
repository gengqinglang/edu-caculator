<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ å¿«é€ŸåŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .test-container { background: white; padding: 20px; border-radius: 8px; margin: 10px 0; }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .info { color: #17a2b8; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>ğŸš€ æ•™è‚²è´¹ç”¨è®¡ç®—å™¨ - å¿«é€ŸåŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-container">
        <h3>é€‚é…å™¨åˆå§‹åŒ–æµ‹è¯•</h3>
        <button onclick="testAdapterInit()">æµ‹è¯•é€‚é…å™¨åˆå§‹åŒ–</button>
        <div id="adapter-results"></div>
    </div>

    <div class="test-container">
        <h3>å„é˜¶æ®µåŠŸèƒ½æµ‹è¯•</h3>
        <button onclick="testStage('kindergarten', 'public')">æµ‹è¯•å¹¼å„¿å›­</button>
        <button onclick="testStage('primary', 'public')">æµ‹è¯•å°å­¦</button>
        <button onclick="testStage('middle', 'public')">æµ‹è¯•åˆä¸­</button>
        <button onclick="testStage('high', 'domesticPublic')">æµ‹è¯•é«˜ä¸­</button>
        <button onclick="testStage('university', 'domesticPublic')">æµ‹è¯•å¤§å­¦</button>
        <button onclick="testStage('graduate', 'domesticAcademic')">æµ‹è¯•ç ”ç©¶ç”Ÿ</button>
        <button onclick="testStage('phd', 'domesticPublic')">æµ‹è¯•åšå£«</button>
        <div id="stage-results"></div>
    </div>

    <!-- å¼•å…¥æ‰€æœ‰å¿…è¦æ–‡ä»¶ -->
    <script src="education-stages-config.js"></script>
    <script src="city-tier-mapping.js"></script>
    <script src="kindergarten-cost-data.js"></script>
    <script src="primary-cost-data.js"></script>
    <script src="middle-cost-data.js"></script>
    <script src="kindergarten-primary-middle-adapter.js"></script>
    <script src="high-school-cost-data.js"></script>
    <script src="high-school-adapter.js"></script>
    <script src="university-cost-data.js"></script>
    <script src="university-adapter.js"></script>
    <script src="graduate-cost-data.js"></script>
    <script src="graduate-adapter.js"></script>
    <script src="phd-cost-data.js"></script>
    <script src="phd-adapter.js"></script>

    <script>
        // å…¨å±€é€‚é…å™¨å˜é‡
        let kindergartenPrimaryMiddleAdapter;
        let highSchoolAdapter;
        let universityAdapter;
        let graduateAdapter;
        let phdAdapter;

        // åˆå§‹åŒ–é€‚é…å™¨
        function initializeAdapters() {
            try {
                kindergartenPrimaryMiddleAdapter = new KindergartenPrimaryMiddleAdapter();
                highSchoolAdapter = new HighSchoolAdapter();
                universityAdapter = new UniversityAdapter();
                graduateAdapter = new GraduateAdapter();
                phdAdapter = new PhdAdapter();
                return true;
            } catch (error) {
                console.error('é€‚é…å™¨åˆå§‹åŒ–å¤±è´¥:', error);
                return false;
            }
        }

        // ç»Ÿä¸€çš„é€‚é…å™¨è·¯ç”±å‡½æ•°
        function getAdapterForStage(stageCode) {
            if (kindergartenPrimaryMiddleAdapter && kindergartenPrimaryMiddleAdapter.isStageSupported(stageCode)) {
                return kindergartenPrimaryMiddleAdapter;
            } else if (highSchoolAdapter && highSchoolAdapter.isStageSupported(stageCode)) {
                return highSchoolAdapter;
            } else if (universityAdapter && universityAdapter.isStageSupported(stageCode)) {
                return universityAdapter;
            } else if (graduateAdapter && graduateAdapter.isStageSupported(stageCode)) {
                return graduateAdapter;
            } else if (phdAdapter && phdAdapter.isStageSupported(stageCode)) {
                return phdAdapter;
            }
            return null;
        }

        // æµ‹è¯•é€‚é…å™¨åˆå§‹åŒ–
        function testAdapterInit() {
            const resultsDiv = document.getElementById('adapter-results');
            resultsDiv.innerHTML = '';

            const success = initializeAdapters();
            
            if (success) {
                resultsDiv.innerHTML += '<div class="result success">âœ… æ‰€æœ‰é€‚é…å™¨åˆå§‹åŒ–æˆåŠŸ</div>';
                
                // æµ‹è¯•æ¯ä¸ªé€‚é…å™¨
                const adapters = [
                    { name: 'å¹¼å°åˆé€‚é…å™¨', adapter: kindergartenPrimaryMiddleAdapter },
                    { name: 'é«˜ä¸­é€‚é…å™¨', adapter: highSchoolAdapter },
                    { name: 'å¤§å­¦é€‚é…å™¨', adapter: universityAdapter },
                    { name: 'ç ”ç©¶ç”Ÿé€‚é…å™¨', adapter: graduateAdapter },
                    { name: 'åšå£«é€‚é…å™¨', adapter: phdAdapter }
                ];

                adapters.forEach(({ name, adapter }) => {
                    if (adapter) {
                        resultsDiv.innerHTML += `<div class="result success">âœ… ${name}: å·²åˆå§‹åŒ–</div>`;
                    } else {
                        resultsDiv.innerHTML += `<div class="result error">âŒ ${name}: åˆå§‹åŒ–å¤±è´¥</div>`;
                    }
                });
            } else {
                resultsDiv.innerHTML += '<div class="result error">âŒ é€‚é…å™¨åˆå§‹åŒ–å¤±è´¥</div>';
            }
        }

        // æµ‹è¯•å•ä¸ªé˜¶æ®µ
        function testStage(stageCode, levelCode) {
            const resultsDiv = document.getElementById('stage-results');
            
            try {
                const adapter = getAdapterForStage(stageCode);
                
                if (!adapter) {
                    resultsDiv.innerHTML += `<div class="result error">âŒ ${stageCode}: æœªæ‰¾åˆ°é€‚é…å™¨</div>`;
                    return;
                }

                // æµ‹è¯•æ•°æ®è·å–
                let costData;
                if (stageCode === 'kindergarten' || stageCode === 'primary' || stageCode === 'middle') {
                    costData = adapter.getCostData(stageCode, levelCode, 'beijing', 'balanced');
                } else if (stageCode === 'high') {
                    costData = adapter.getCostData(stageCode, levelCode, 'beijing', '', 'balanced');
                } else {
                    costData = adapter.getCostData(stageCode, '', levelCode, '', '');
                }

                if (costData && costData.costs) {
                    const totalCost = Object.values(costData.costs).reduce((sum, cost) => sum + cost.amount, 0);
                    resultsDiv.innerHTML += `<div class="result success">âœ… ${stageCode}: è·å–æ•°æ®æˆåŠŸï¼Œæ€»è´¹ç”¨ Â¥${totalCost.toLocaleString()}</div>`;
                } else {
                    resultsDiv.innerHTML += `<div class="result error">âŒ ${stageCode}: æ•°æ®è·å–å¤±è´¥</div>`;
                }

            } catch (error) {
                resultsDiv.innerHTML += `<div class="result error">âŒ ${stageCode}: æµ‹è¯•å¼‚å¸¸ - ${error.message}</div>`;
                console.error(`${stageCode}æµ‹è¯•å¤±è´¥:`, error);
            }
        }

        // é¡µé¢åŠ è½½åè‡ªåŠ¨åˆå§‹åŒ–
        window.addEventListener('load', function() {
            setTimeout(() => {
                testAdapterInit();
            }, 100);
        });
    </script>
</body>
</html>
