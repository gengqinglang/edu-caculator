<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å…¼å®¹æ€§ä¿®å¤æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 15px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .code { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 3px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>ğŸ”§ å…¼å®¹æ€§ä¿®å¤æµ‹è¯•</h1>
    
    <button onclick="testCompatibility()">æµ‹è¯•å…¼å®¹æ€§ä¿®å¤</button>
    
    <div id="testResults"></div>

    <!-- å¼•å…¥æ•°æ®æ–‡ä»¶ -->
    <script src="city-tier-mapping.js"></script>
    <script src="primary-cost-data.js"></script>
    <script src="kindergarten-primary-middle-adapter.js"></script>

    <script>
        function testCompatibility() {
            const resultsDiv = document.getElementById('testResults');
            let html = '';
            
            try {
                // åˆå§‹åŒ–é€‚é…å™¨
                const adapter = new KindergartenPrimaryMiddleAdapter();
                
                // æµ‹è¯•æ•°æ®è·å–
                const costData = adapter.getCostData('primary', 'public', 'beijing', 'balanced');
                const calculation = adapter.calculateTotalCost(costData, 6);
                
                console.log('è®¡ç®—ç»“æœ:', calculation);
                
                // æ£€æŸ¥æ–°ç»“æ„
                html += '<div class="test-result success">';
                html += '<h3>âœ… æ–°æ•°æ®ç»“æ„æ£€æŸ¥</h3>';
                html += `<p><strong>totalCost:</strong> ${calculation.totalCost}</p>`;
                html += `<p><strong>yearlyTotal:</strong> ${calculation.yearlyTotal}</p>`;
                html += `<p><strong>oneTimeCost:</strong> ${calculation.oneTimeCost}</p>`;
                html += '</div>';
                
                // æ£€æŸ¥å…¼å®¹æ€§ç»“æ„ï¼ˆsummaryå¯¹è±¡ï¼‰
                if (calculation.summary) {
                    html += '<div class="test-result success">';
                    html += '<h3>âœ… å…¼å®¹æ€§ç»“æ„æ£€æŸ¥ (summaryå¯¹è±¡)</h3>';
                    html += `<p><strong>summary.periodicTotal:</strong> ${calculation.summary.periodicTotal}</p>`;
                    html += `<p><strong>summary.yearlyTotal:</strong> ${calculation.summary.yearlyTotal}</p>`;
                    html += `<p><strong>summary.onceTotal:</strong> ${calculation.summary.onceTotal}</p>`;
                    html += `<p><strong>summary.grandTotal:</strong> ${calculation.summary.grandTotal}</p>`;
                    html += '</div>';
                    
                    // éªŒè¯æ•°å€¼ä¸€è‡´æ€§
                    const periodicMatch = calculation.totalCost === calculation.summary.periodicTotal;
                    const yearlyMatch = calculation.yearlyTotal === calculation.summary.yearlyTotal;
                    const onceMatch = calculation.oneTimeCost === calculation.summary.onceTotal;
                    
                    html += '<div class="test-result ' + (periodicMatch && yearlyMatch && onceMatch ? 'success' : 'error') + '">';
                    html += '<h3>ğŸ” æ•°å€¼ä¸€è‡´æ€§æ£€æŸ¥</h3>';
                    html += `<p>periodicTotal ä¸€è‡´æ€§: ${periodicMatch ? 'âœ…' : 'âŒ'} (${calculation.totalCost} vs ${calculation.summary.periodicTotal})</p>`;
                    html += `<p>yearlyTotal ä¸€è‡´æ€§: ${yearlyMatch ? 'âœ…' : 'âŒ'} (${calculation.yearlyTotal} vs ${calculation.summary.yearlyTotal})</p>`;
                    html += `<p>onceTotal ä¸€è‡´æ€§: ${onceMatch ? 'âœ…' : 'âŒ'} (${calculation.oneTimeCost} vs ${calculation.summary.onceTotal})</p>`;
                    html += '</div>';
                    
                } else {
                    html += '<div class="test-result error">';
                    html += '<h3>âŒ å…¼å®¹æ€§ç»“æ„ç¼ºå¤±</h3>';
                    html += '<p>calculation.summary å¯¹è±¡ä¸å­˜åœ¨</p>';
                    html += '</div>';
                }
                
                // æ¨¡æ‹ŸåŸç³»ç»Ÿçš„è°ƒç”¨æ–¹å¼
                html += '<div class="test-result">';
                html += '<h3>ğŸ¯ åŸç³»ç»Ÿè°ƒç”¨æ¨¡æ‹Ÿ</h3>';
                html += '<div class="code">';
                html += '// åŸç³»ç»ŸæœŸæœ›çš„è°ƒç”¨æ–¹å¼ï¼š<br>';
                html += `Math.round(calculation.summary.periodicTotal).toLocaleString()<br>`;
                html += '// ç»“æœï¼š';
                
                try {
                    const result = Math.round(calculation.summary.periodicTotal).toLocaleString();
                    html += ` âœ… ${result}`;
                } catch (error) {
                    html += ` âŒ ${error.message}`;
                }
                html += '</div>';
                html += '</div>';
                
                // æµ‹è¯•é”™è¯¯æƒ…å†µ
                html += '<div class="test-result">';
                html += '<h3>ğŸš¨ é”™è¯¯æƒ…å†µæµ‹è¯•</h3>';
                const errorCalc = adapter.calculateTotalCost(null, 0);
                if (errorCalc.summary) {
                    html += '<p>âœ… é”™è¯¯æƒ…å†µä¸‹ä¹Ÿè¿”å›äº† summary å¯¹è±¡</p>';
                    html += `<p>é”™è¯¯æ—¶çš„ periodicTotal: ${errorCalc.summary.periodicTotal}</p>`;
                } else {
                    html += '<p>âŒ é”™è¯¯æƒ…å†µä¸‹ç¼ºå°‘ summary å¯¹è±¡</p>';
                }
                html += '</div>';
                
            } catch (error) {
                html += '<div class="test-result error">';
                html += '<h3>âŒ æµ‹è¯•å¤±è´¥</h3>';
                html += `<p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>`;
                html += `<p>é”™è¯¯å †æ ˆ: <pre>${error.stack}</pre></p>`;
                html += '</div>';
            }
            
            resultsDiv.innerHTML = html;
        }
    </script>
</body>
</html>
