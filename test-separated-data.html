<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†ç¦»æ•°æ®æ–‡ä»¶æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; }
        .test-section { margin: 30px 0; padding: 20px; border: 2px solid #ddd; border-radius: 8px; }
        .stage-section { margin: 20px 0; padding: 15px; background: #f9f9f9; border-radius: 5px; }
        .result { margin: 10px 0; padding: 15px; background: #f5f5f5; border-radius: 5px; }
        .error { color: red; background: #ffe6e6; }
        .success { color: green; background: #e6ffe6; }
        .warning { color: orange; background: #fff3e0; }
        button { margin: 5px; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .data-table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        .data-table th, .data-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .data-table th { background: #f2f2f2; font-weight: bold; }
        .metadata { background: #e3f2fd; padding: 10px; border-radius: 5px; margin: 10px 0; }
        h1 { color: #333; text-align: center; }
        h2 { color: #0066cc; border-bottom: 2px solid #0066cc; padding-bottom: 5px; }
        h3 { color: #0088cc; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ« å¹¼å°åˆåˆ†ç¦»æ•°æ®æ–‡ä»¶åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>ğŸ“‹ æ•°æ®æ–‡ä»¶åŠ è½½æµ‹è¯•</h2>
            <button class="btn-primary" onclick="testDataLoading()">æµ‹è¯•æ•°æ®æ–‡ä»¶åŠ è½½</button>
            <div id="dataLoadingResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ™ï¸ åŸå¸‚æ˜ å°„åŠŸèƒ½æµ‹è¯•</h2>
            <button class="btn-primary" onclick="testCityMapping()">æµ‹è¯•åŸå¸‚æ˜ å°„</button>
            <div id="cityMappingResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ’ å„é˜¶æ®µè´¹ç”¨æ•°æ®æµ‹è¯•</h2>
            
            <div class="stage-section">
                <h3>ğŸ§¸ å¹¼å„¿å›­æ•°æ®æµ‹è¯•</h3>
                <button class="btn-success" onclick="testKindergartenData()">æµ‹è¯•å¹¼å„¿å›­æ•°æ®</button>
                <div id="kindergartenResult" class="result"></div>
            </div>
            
            <div class="stage-section">
                <h3>ğŸ“š å°å­¦æ•°æ®æµ‹è¯•</h3>
                <button class="btn-success" onclick="testPrimaryData()">æµ‹è¯•å°å­¦æ•°æ®</button>
                <div id="primaryResult" class="result"></div>
            </div>
            
            <div class="stage-section">
                <h3>ğŸ“ åˆä¸­æ•°æ®æµ‹è¯•</h3>
                <button class="btn-success" onclick="testMiddleData()">æµ‹è¯•åˆä¸­æ•°æ®</button>
                <div id="middleResult" class="result"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ§® é€‚é…å™¨é›†æˆæµ‹è¯•</h2>
            <button class="btn-warning" onclick="testAdapterIntegration()">æµ‹è¯•é€‚é…å™¨é›†æˆ</button>
            <div id="adapterResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ’° è´¹ç”¨è®¡ç®—å®Œæ•´æµ‹è¯•</h2>
            <button class="btn-warning" onclick="testCompleteCalculation()">æµ‹è¯•å®Œæ•´è´¹ç”¨è®¡ç®—</button>
            <div id="calculationResult" class="result"></div>
        </div>
    </div>

    <!-- å¼•å…¥åˆ†ç¦»çš„æ•°æ®æ–‡ä»¶ -->
    <script src="city-tier-mapping.js"></script>
    <script src="kindergarten-cost-data.js"></script>
    <script src="primary-cost-data.js"></script>
    <script src="middle-cost-data.js"></script>
    <script src="kindergarten-primary-middle-adapter.js"></script>

    <script>
        let adapter;
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
        });

        function testDataLoading() {
            const result = document.getElementById('dataLoadingResult');
            let html = '<h4>æ•°æ®æ–‡ä»¶åŠ è½½çŠ¶æ€æ£€æŸ¥:</h4>';
            let allLoaded = true;
            
            const dataFiles = [
                { name: 'city-tier-mapping.js', check: () => typeof getCityTier !== 'undefined' },
                { name: 'kindergarten-cost-data.js', check: () => typeof KINDERGARTEN_COST_DATA !== 'undefined' },
                { name: 'primary-cost-data.js', check: () => typeof PRIMARY_COST_DATA !== 'undefined' },
                { name: 'middle-cost-data.js', check: () => typeof MIDDLE_COST_DATA !== 'undefined' }
            ];
            
            dataFiles.forEach(file => {
                const loaded = file.check();
                allLoaded = allLoaded && loaded;
                html += `<p class="${loaded ? 'success' : 'error'}">
                    ${file.name}: ${loaded ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½'}
                </p>`;
            });
            
            // æµ‹è¯•é€‚é…å™¨åˆå§‹åŒ–
            try {
                adapter = new KindergartenPrimaryMiddleAdapter();
                html += `<p class="success">âœ… é€‚é…å™¨åˆå§‹åŒ–æˆåŠŸ</p>`;
                
                // æ˜¾ç¤ºå…ƒæ•°æ®ä¿¡æ¯
                html += '<div class="metadata">';
                html += '<h5>ğŸ“Š æ•°æ®æ–‡ä»¶å…ƒæ•°æ®:</h5>';
                html += `<p><strong>å¹¼å„¿å›­æ•°æ®ç‰ˆæœ¬:</strong> ${KINDERGARTEN_COST_DATA.metadata.version} (${KINDERGARTEN_COST_DATA.metadata.lastUpdated})</p>`;
                html += `<p><strong>å°å­¦æ•°æ®ç‰ˆæœ¬:</strong> ${PRIMARY_COST_DATA.metadata.version} (${PRIMARY_COST_DATA.metadata.lastUpdated})</p>`;
                html += `<p><strong>åˆä¸­æ•°æ®ç‰ˆæœ¬:</strong> ${MIDDLE_COST_DATA.metadata.version} (${MIDDLE_COST_DATA.metadata.lastUpdated})</p>`;
                html += '</div>';
                
            } catch (error) {
                allLoaded = false;
                html += `<p class="error">âŒ é€‚é…å™¨åˆå§‹åŒ–å¤±è´¥: ${error.message}</p>`;
            }
            
            html += `<p><strong>æ€»ä½“çŠ¶æ€: ${allLoaded ? 'âœ… å…¨éƒ¨æ­£å¸¸' : 'âŒ å­˜åœ¨é—®é¢˜'}</strong></p>`;
            result.innerHTML = html;
        }

        function testCityMapping() {
            const result = document.getElementById('cityMappingResult');
            const testCases = [
                { city: 'beijing', expected: 'ä¸€çº¿åŸå¸‚', desc: 'åŒ—äº¬' },
                { city: 'shanghai', expected: 'ä¸€çº¿åŸå¸‚', desc: 'ä¸Šæµ·' },
                { city: 'chengdu', expected: 'äºŒçº¿åŸå¸‚', desc: 'æˆéƒ½' },
                { city: 'hangzhou', expected: 'äºŒçº¿åŸå¸‚', desc: 'æ­å·' },
                { city: 'wuxi', expected: 'ä¸‰çº¿åŸå¸‚', desc: 'æ— é”¡' },
                { city: 'unknown_city', expected: 'å››çº¿åŠä»¥ä¸‹', desc: 'æœªçŸ¥åŸå¸‚' }
            ];
            
            let html = '<h4>åŸå¸‚ç­‰çº§æ˜ å°„æµ‹è¯•ç»“æœ:</h4>';
            html += '<table class="data-table"><tr><th>åŸå¸‚</th><th>æœŸæœ›ç­‰çº§</th><th>å®é™…ç­‰çº§</th><th>ç»“æœ</th></tr>';
            
            let allPassed = true;
            testCases.forEach(testCase => {
                const actualTier = getCityTier(testCase.city);
                const passed = actualTier === testCase.expected;
                allPassed = allPassed && passed;
                
                html += `<tr class="${passed ? 'success' : 'error'}">
                    <td>${testCase.desc} (${testCase.city})</td>
                    <td>${testCase.expected}</td>
                    <td>${actualTier}</td>
                    <td>${passed ? 'âœ…' : 'âŒ'}</td>
                </tr>`;
            });
            
            html += '</table>';
            html += `<p><strong>æµ‹è¯•ç»“æœ: ${allPassed ? 'âœ… å…¨éƒ¨é€šè¿‡' : 'âŒ å­˜åœ¨å¤±è´¥'}</strong></p>`;
            result.innerHTML = html;
        }

        function testKindergartenData() {
            const result = document.getElementById('kindergartenResult');
            testStageData('kindergarten', KINDERGARTEN_COST_DATA, result, 'å¹¼å„¿å›­');
        }

        function testPrimaryData() {
            const result = document.getElementById('primaryResult');
            testStageData('primary', PRIMARY_COST_DATA, result, 'å°å­¦');
        }

        function testMiddleData() {
            const result = document.getElementById('middleResult');
            testStageData('middle', MIDDLE_COST_DATA, result, 'åˆä¸­');
        }

        function testStageData(stage, stageData, resultElement, stageName) {
            let html = `<h4>${stageName}æ•°æ®ç»“æ„æµ‹è¯•:</h4>`;
            
            // æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
            const cityTiers = ['ä¸€çº¿åŸå¸‚', 'äºŒçº¿åŸå¸‚', 'ä¸‰çº¿åŸå¸‚', 'å››çº¿åŠä»¥ä¸‹'];
            const schoolTypes = ['å…¬ç«‹', 'ç§ç«‹(ä¸­æ¡£)', 'ç§ç«‹(é«˜æ¡£)'];
            const costItems = ['tuition', 'meal', 'misc', 'extracurricular'];
            const parentingStyles = ['relaxed', 'balanced', 'intensive'];
            
            let dataComplete = true;
            let totalDataPoints = 0;
            let validDataPoints = 0;
            
            html += '<table class="data-table">';
            html += '<tr><th>åŸå¸‚ç­‰çº§</th><th>å­¦æ ¡ç±»å‹</th><th>æ•°æ®å®Œæ•´æ€§</th><th>æ ·æœ¬è´¹ç”¨</th></tr>';
            
            cityTiers.forEach(cityTier => {
                schoolTypes.forEach(schoolType => {
                    const data = stageData[cityTier]?.[schoolType];
                    totalDataPoints++;
                    
                    if (data) {
                        // æ£€æŸ¥åŸºæœ¬è´¹ç”¨é¡¹
                        const hasAllItems = costItems.every(item => data[item] !== undefined);
                        // æ£€æŸ¥è¯¾å¤–è´¹çš„æ•™è‚²é£æ ¼
                        const hasAllStyles = parentingStyles.every(style => 
                            data.extracurricular && data.extracurricular[style] !== undefined
                        );
                        
                        if (hasAllItems && hasAllStyles) {
                            validDataPoints++;
                            html += `<tr class="success">
                                <td>${cityTier}</td>
                                <td>${schoolType}</td>
                                <td>âœ… å®Œæ•´</td>
                                <td>å­¦è´¹: ${data.tuition.min}-${data.tuition.max}å…ƒ</td>
                            </tr>`;
                        } else {
                            dataComplete = false;
                            html += `<tr class="error">
                                <td>${cityTier}</td>
                                <td>${schoolType}</td>
                                <td>âŒ ä¸å®Œæ•´</td>
                                <td>ç¼ºå°‘å¿…è¦å­—æ®µ</td>
                            </tr>`;
                        }
                    } else {
                        dataComplete = false;
                        html += `<tr class="error">
                            <td>${cityTier}</td>
                            <td>${schoolType}</td>
                            <td>âŒ ç¼ºå¤±</td>
                            <td>æ•°æ®ä¸å­˜åœ¨</td>
                        </tr>`;
                    }
                });
            });
            
            html += '</table>';
            html += `<div class="metadata">
                <p><strong>æ•°æ®å®Œæ•´æ€§ç»Ÿè®¡:</strong></p>
                <p>æ€»æ•°æ®ç‚¹: ${totalDataPoints}</p>
                <p>æœ‰æ•ˆæ•°æ®ç‚¹: ${validDataPoints}</p>
                <p>å®Œæ•´ç‡: ${Math.round(validDataPoints/totalDataPoints*100)}%</p>
                <p>çŠ¶æ€: ${dataComplete ? 'âœ… æ•°æ®å®Œæ•´' : 'âŒ æ•°æ®ä¸å®Œæ•´'}</p>
            </div>`;
            
            resultElement.innerHTML = html;
        }

        function testAdapterIntegration() {
            const result = document.getElementById('adapterResult');
            
            if (!adapter) {
                result.innerHTML = '<p class="error">âŒ é€‚é…å™¨æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆè¿è¡Œæ•°æ®åŠ è½½æµ‹è¯•</p>';
                return;
            }
            
            const testCases = [
                {
                    stage: 'kindergarten',
                    level: 'public',
                    city: 'beijing',
                    style: 'balanced',
                    desc: 'åŒ—äº¬å…¬ç«‹å¹¼å„¿å›­å¹³è¡¡é£æ ¼'
                },
                {
                    stage: 'primary',
                    level: 'private_mid',
                    city: 'shanghai',
                    style: 'intensive',
                    desc: 'ä¸Šæµ·ç§ç«‹å°å­¦(ä¸­æ¡£)é¸¡å¨ƒé£æ ¼'
                },
                {
                    stage: 'middle',
                    level: 'private_high',
                    city: 'chengdu',
                    style: 'relaxed',
                    desc: 'æˆéƒ½ç§ç«‹åˆä¸­(é«˜æ¡£)ä½›ç³»é£æ ¼'
                }
            ];
            
            let html = '<h4>é€‚é…å™¨é›†æˆæµ‹è¯•ç»“æœ:</h4>';
            html += '<table class="data-table">';
            html += '<tr><th>æµ‹è¯•æ¡ˆä¾‹</th><th>åŸå¸‚ç­‰çº§</th><th>å­¦è´¹</th><th>é¤è´¹</th><th>è¯¾å¤–è´¹</th><th>çŠ¶æ€</th></tr>';
            
            let allPassed = true;
            testCases.forEach(testCase => {
                try {
                    const costData = adapter.getCostData(
                        testCase.stage,
                        testCase.level,
                        testCase.city,
                        testCase.style
                    );
                    
                    if (costData && costData.costs) {
                        const costs = costData.costs;
                        html += `<tr class="success">
                            <td>${testCase.desc}</td>
                            <td>${costData.cityTier}</td>
                            <td>${costs['å­¦è´¹'].amount}å…ƒ/${costs['å­¦è´¹'].unit}</td>
                            <td>${costs['é¤è´¹'].amount}å…ƒ/${costs['é¤è´¹'].unit}</td>
                            <td>${costs['è¯¾å¤–è´¹'].amount}å…ƒ/${costs['è¯¾å¤–è´¹'].unit}</td>
                            <td>âœ…</td>
                        </tr>`;
                    } else {
                        allPassed = false;
                        html += `<tr class="error">
                            <td>${testCase.desc}</td>
                            <td colspan="4">æ•°æ®è·å–å¤±è´¥</td>
                            <td>âŒ</td>
                        </tr>`;
                    }
                } catch (error) {
                    allPassed = false;
                    html += `<tr class="error">
                        <td>${testCase.desc}</td>
                        <td colspan="4">é”™è¯¯: ${error.message}</td>
                        <td>âŒ</td>
                    </tr>`;
                }
            });
            
            html += '</table>';
            html += `<p><strong>é›†æˆæµ‹è¯•ç»“æœ: ${allPassed ? 'âœ… å…¨éƒ¨é€šè¿‡' : 'âŒ å­˜åœ¨é—®é¢˜'}</strong></p>`;
            result.innerHTML = html;
        }

        function testCompleteCalculation() {
            const result = document.getElementById('calculationResult');
            
            if (!adapter) {
                result.innerHTML = '<p class="error">âŒ é€‚é…å™¨æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆè¿è¡Œæ•°æ®åŠ è½½æµ‹è¯•</p>';
                return;
            }
            
            const testCase = {
                stage: 'primary',
                level: 'public',
                city: 'beijing',
                style: 'balanced',
                years: 6
            };
            
            try {
                const costData = adapter.getCostData(
                    testCase.stage,
                    testCase.level,
                    testCase.city,
                    testCase.style
                );
                
                const calculation = adapter.calculateTotalCost(costData, testCase.years);
                
                let html = '<h4>å®Œæ•´è´¹ç”¨è®¡ç®—æµ‹è¯• - åŒ—äº¬å…¬ç«‹å°å­¦6å¹´</h4>';
                html += '<div class="metadata">';
                html += `<p><strong>åŸå¸‚ç­‰çº§:</strong> ${costData.cityTier}</p>`;
                html += `<p><strong>æ•™è‚²é£æ ¼:</strong> ${costData.educationStyle}</p>`;
                html += `<p><strong>æ•°æ®æ¥æº:</strong> ${costData.dataSource}</p>`;
                html += '</div>';
                
                html += '<table class="data-table">';
                html += '<tr><th>è´¹ç”¨é¡¹ç›®</th><th>å•ä»·</th><th>å•ä½</th><th>æ€»è®¡</th></tr>';
                
                Object.entries(calculation.details).forEach(([key, detail]) => {
                    html += `<tr>
                        <td>${key}</td>
                        <td>${detail.amount.toLocaleString()}å…ƒ</td>
                        <td>${detail.unit}</td>
                        <td>${detail.itemTotal.toLocaleString()}å…ƒ</td>
                    </tr>`;
                });
                
                html += '</table>';
                
                html += '<div class="metadata">';
                html += '<h5>ğŸ’° è´¹ç”¨æ±‡æ€»:</h5>';
                html += `<p><strong>æ€»è´¹ç”¨:</strong> ${calculation.totalCost.toLocaleString()}å…ƒ</p>`;
                html += `<p><strong>å¹´å‡è´¹ç”¨:</strong> ${calculation.yearlyTotal.toLocaleString()}å…ƒ</p>`;
                html += `<p><strong>ä¸€æ¬¡æ€§è´¹ç”¨:</strong> ${calculation.oneTimeCost.toLocaleString()}å…ƒ</p>`;
                html += `<p><strong>è®¡ç®—å¹´æ•°:</strong> ${calculation.years}å¹´</p>`;
                html += '</div>';
                
                html += '<p class="success"><strong>âœ… å®Œæ•´è´¹ç”¨è®¡ç®—æµ‹è¯•é€šè¿‡</strong></p>';
                result.innerHTML = html;
                
            } catch (error) {
                result.innerHTML = `<p class="error">âŒ è´¹ç”¨è®¡ç®—å¤±è´¥: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
