<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœªæ¥é˜¶æ®µè´¹ç”¨æ˜¾ç¤ºä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
        }
        
        .test-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .test-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 16px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
        
        .test-case {
            margin-bottom: 16px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .test-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .test-button:hover {
            background: #2980b9;
        }
        
        .test-result {
            font-family: 'Monaco', 'Menlo', monospace;
            background: #2c3e50;
            color: #ecf0f1;
            padding: 12px;
            border-radius: 6px;
            white-space: pre-wrap;
            margin-top: 8px;
        }
        
        .success {
            color: #27ae60;
            font-weight: 600;
        }
        
        .error {
            color: #e74c3c;
            font-weight: 600;
        }
        
        .info {
            color: #3498db;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª æœªæ¥é˜¶æ®µè´¹ç”¨æ˜¾ç¤ºä¿®å¤æµ‹è¯•</h1>
    
    <div class="test-section">
        <div class="test-title">ğŸ“‹ ä¿®å¤å†…å®¹è¯´æ˜</div>
        <ul>
            <li><strong>é—®é¢˜</strong>ï¼šé€‰æ‹©æ•™è‚²æ°´å¹³åï¼Œæœªæ¥é˜¶æ®µå¡ç‰‡æ²¡æœ‰æ˜¾ç¤ºè´¹ç”¨æ±‡æ€»å’Œæ˜ç»†</li>
            <li><strong>æ ¹å› </strong>ï¼šå¹¼å°åˆé˜¶æ®µéœ€è¦ç­‰å¾…åŸå¸‚é€‰æ‹©æ‰æ˜¾ç¤ºè´¹ç”¨ï¼Œä½†å®é™…åº”è¯¥ç›´æ¥è®¡ç®—</li>
            <li><strong>ä¿®å¤</strong>ï¼šä¸ºå¹¼å°åˆé˜¶æ®µæ·»åŠ ç‰¹æ®Šå¤„ç†é€»è¾‘ï¼Œæ”¯æŒç›´æ¥è®¡ç®—è´¹ç”¨</li>
        </ul>
    </div>

    <div class="test-section">
        <div class="test-title">ğŸ” æµ‹è¯•åœºæ™¯</div>
        
        <div class="test-case">
            <strong>æµ‹è¯•1ï¼šæ£€æŸ¥ä¿®å¤å‡½æ•°æ˜¯å¦æ­£ç¡®åŠ è½½</strong>
            <br>
            <button class="test-button" onclick="testFunctionLoaded()">æµ‹è¯•å‡½æ•°åŠ è½½</button>
            <div id="functionResult" class="test-result"></div>
        </div>
        
        <div class="test-case">
            <strong>æµ‹è¯•2ï¼šæ¨¡æ‹Ÿå¹¼å°åˆé˜¶æ®µè¯†åˆ«</strong>
            <br>
            <button class="test-button" onclick="testKMPStageDetection()">æµ‹è¯•é˜¶æ®µè¯†åˆ«</button>
            <div id="stageResult" class="test-result"></div>
        </div>
        
        <div class="test-case">
            <strong>æµ‹è¯•3ï¼šæ¨¡æ‹Ÿè´¹ç”¨æ•°æ®è·å–</strong>
            <br>
            <button class="test-button" onclick="testCostDataRetrieval()">æµ‹è¯•è´¹ç”¨è·å–</button>
            <div id="costResult" class="test-result"></div>
        </div>
        
        <div class="test-case">
            <strong>æµ‹è¯•4ï¼šæ¨¡æ‹ŸåŸå¸‚å¤„ç†é€»è¾‘</strong>
            <br>
            <button class="test-button" onclick="testCityHandling()">æµ‹è¯•åŸå¸‚å¤„ç†</button>
            <div id="cityResult" class="test-result"></div>
        </div>
    </div>

    <div class="test-section">
        <div class="test-title">ğŸ¯ å®é™…æµ‹è¯•æŒ‡å¯¼</div>
        <div class="test-case">
            <p><strong>è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤åœ¨ä¸»é¡µé¢æµ‹è¯•ï¼š</strong></p>
            <ol>
                <li>è®¿é—® <code>http://localhost:3000/</code></li>
                <li>å¡«å†™åŸºç¡€ä¿¡æ¯ï¼šåŒ—äº¬ã€å°å­¦ã€ä¸€å¹´çº§ã€å…¬ç«‹å°å­¦ã€é¸¡å¨ƒ</li>
                <li>ç‚¹å‡»"å¼€å§‹è®¡ç®—æ•™è‚²è´¹ç”¨"</li>
                <li>åœ¨æœªæ¥é˜¶æ®µå¡ç‰‡ä¸­ï¼Œé€‰æ‹©"åˆä¸­" â†’ "å…¬ç«‹åˆä¸­"</li>
                <li><strong>é¢„æœŸç»“æœ</strong>ï¼šç«‹å³æ˜¾ç¤ºè´¹ç”¨æ±‡æ€»å¡ç‰‡å’Œè¯¦ç»†è´¹ç”¨æ¸…å•</li>
                <li><strong>å…³é”®æŒ‡æ ‡</strong>ï¼šè¯¾å¤–è´¹åº”è¯¥æ˜¾ç¤ºä¸ºé¸¡å¨ƒé£æ ¼çš„é‡‘é¢ï¼ˆè¾ƒé«˜ï¼‰</li>
            </ol>
        </div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„JSæ–‡ä»¶ -->
    <script src="education-stages-config.js"></script>
    <script src="city-tier-mapping.js"></script>
    <script src="kindergarten-cost-data.js"></script>
    <script src="primary-cost-data.js"></script>
    <script src="middle-cost-data.js"></script>
    <script src="kindergarten-primary-middle-adapter.js"></script>

    <script>
        // æ¨¡æ‹Ÿå…¨å±€å˜é‡
        let kindergartenPrimaryMiddleAdapter;
        let userPlan = {
            currentStage: 'primary',
            currentCity: 'beijing',
            educationStyle: 'intensive'
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            try {
                kindergartenPrimaryMiddleAdapter = new KindergartenPrimaryMiddleAdapter();
                console.log('âœ… é€‚é…å™¨åˆå§‹åŒ–æˆåŠŸ');
            } catch (error) {
                console.error('âŒ é€‚é…å™¨åˆå§‹åŒ–å¤±è´¥:', error);
            }
        });

        function testFunctionLoaded() {
            const result = document.getElementById('functionResult');
            try {
                const tests = {
                    "EDUCATION_STAGES_CONFIGåŠ è½½": typeof EDUCATION_STAGES_CONFIG !== 'undefined',
                    "getCityTierå‡½æ•°åŠ è½½": typeof getCityTier !== 'undefined',
                    "KindergartenPrimaryMiddleAdapteråŠ è½½": typeof KindergartenPrimaryMiddleAdapter !== 'undefined',
                    "é€‚é…å™¨å®ä¾‹åˆ›å»º": kindergartenPrimaryMiddleAdapter !== undefined,
                    "isStageSupportedæ–¹æ³•": kindergartenPrimaryMiddleAdapter && typeof kindergartenPrimaryMiddleAdapter.isStageSupported === 'function'
                };
                
                const success = Object.values(tests).every(v => v === true);
                result.textContent = JSON.stringify({
                    "æµ‹è¯•ç»“æœ": success ? "âœ… æ‰€æœ‰å‡½æ•°æ­£ç¡®åŠ è½½" : "âŒ éƒ¨åˆ†å‡½æ•°æœªåŠ è½½",
                    "è¯¦ç»†æ£€æŸ¥": tests
                }, null, 2);
                result.style.color = success ? '#27ae60' : '#e74c3c';
            } catch (error) {
                result.textContent = 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message;
                result.style.color = '#e74c3c';
            }
        }

        function testKMPStageDetection() {
            const result = document.getElementById('stageResult');
            try {
                if (!kindergartenPrimaryMiddleAdapter) {
                    throw new Error('é€‚é…å™¨æœªåˆå§‹åŒ–');
                }
                
                const stages = ['kindergarten', 'primary', 'middle', 'high', 'university'];
                const tests = {};
                
                stages.forEach(stage => {
                    tests[`${stage}é˜¶æ®µè¯†åˆ«`] = kindergartenPrimaryMiddleAdapter.isStageSupported(stage);
                });
                
                const kmpCorrect = tests['kindergartené˜¶æ®µè¯†åˆ«'] && tests['primaryé˜¶æ®µè¯†åˆ«'] && tests['middleé˜¶æ®µè¯†åˆ«'];
                const otherCorrect = !tests['highé˜¶æ®µè¯†åˆ«'] && !tests['universityé˜¶æ®µè¯†åˆ«'];
                const success = kmpCorrect && otherCorrect;
                
                result.textContent = JSON.stringify({
                    "æµ‹è¯•ç»“æœ": success ? "âœ… é˜¶æ®µè¯†åˆ«æ­£ç¡®" : "âŒ é˜¶æ®µè¯†åˆ«é”™è¯¯",
                    "è¯¦ç»†ç»“æœ": tests
                }, null, 2);
                result.style.color = success ? '#27ae60' : '#e74c3c';
            } catch (error) {
                result.textContent = 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message;
                result.style.color = '#e74c3c';
            }
        }

        function testCostDataRetrieval() {
            const result = document.getElementById('costResult');
            try {
                if (!kindergartenPrimaryMiddleAdapter) {
                    throw new Error('é€‚é…å™¨æœªåˆå§‹åŒ–');
                }
                
                // æµ‹è¯•ä¸åŒåœºæ™¯çš„è´¹ç”¨è·å–
                const testCases = [
                    { stage: 'middle', level: 'public', city: 'beijing', style: 'intensive' },
                    { stage: 'primary', level: 'private_mid', city: 'shanghai', style: 'balanced' },
                    { stage: 'kindergarten', level: 'public', city: '', style: 'relaxed' } // ç©ºåŸå¸‚æµ‹è¯•
                ];
                
                const results = {};
                
                testCases.forEach((testCase, index) => {
                    try {
                        const costData = kindergartenPrimaryMiddleAdapter.getCostData(
                            testCase.stage,
                            testCase.level,
                            testCase.city,
                            testCase.style
                        );
                        
                        results[`æµ‹è¯•${index + 1}`] = {
                            "è¾“å…¥": testCase,
                            "æˆåŠŸ": true,
                            "è¯¾å¤–è´¹": costData.costs?.è¯¾å¤–è´¹?.amount,
                            "åŸå¸‚ç­‰çº§": costData.cityTier,
                            "æ•™è‚²é£æ ¼": costData.educationStyle
                        };
                    } catch (error) {
                        results[`æµ‹è¯•${index + 1}`] = {
                            "è¾“å…¥": testCase,
                            "æˆåŠŸ": false,
                            "é”™è¯¯": error.message
                        };
                    }
                });
                
                const success = Object.values(results).every(r => r.æˆåŠŸ);
                result.textContent = JSON.stringify({
                    "æµ‹è¯•ç»“æœ": success ? "âœ… è´¹ç”¨è·å–æ­£å¸¸" : "âŒ è´¹ç”¨è·å–å¼‚å¸¸",
                    "è¯¦ç»†ç»“æœ": results
                }, null, 2);
                result.style.color = success ? '#27ae60' : '#e74c3c';
            } catch (error) {
                result.textContent = 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message;
                result.style.color = '#e74c3c';
            }
        }

        function testCityHandling() {
            const result = document.getElementById('cityResult');
            try {
                // æµ‹è¯•ä¸åŒåŸå¸‚è¾“å…¥çš„å¤„ç†
                const testCities = ['beijing', 'shanghai', '', null, undefined, 'unknown_city'];
                const results = {};
                
                testCities.forEach(city => {
                    try {
                        const tier = getCityTier(city);
                        results[`åŸå¸‚"${city}"`] = {
                            "è¾“å…¥": city,
                            "åŸå¸‚ç­‰çº§": tier,
                            "æˆåŠŸ": true
                        };
                    } catch (error) {
                        results[`åŸå¸‚"${city}"`] = {
                            "è¾“å…¥": city,
                            "é”™è¯¯": error.message,
                            "æˆåŠŸ": false
                        };
                    }
                });
                
                const success = Object.values(results).every(r => r.æˆåŠŸ);
                const hasDefaultTier = results['åŸå¸‚""'].åŸå¸‚ç­‰çº§ === "å››çº¿åŠä»¥ä¸‹";
                
                result.textContent = JSON.stringify({
                    "æµ‹è¯•ç»“æœ": success && hasDefaultTier ? "âœ… åŸå¸‚å¤„ç†æ­£å¸¸" : "âŒ åŸå¸‚å¤„ç†å¼‚å¸¸",
                    "ç©ºåŸå¸‚é»˜è®¤å¤„ç†": hasDefaultTier ? "âœ… æ­£ç¡®" : "âŒ é”™è¯¯",
                    "è¯¦ç»†ç»“æœ": results
                }, null, 2);
                result.style.color = success && hasDefaultTier ? '#27ae60' : '#e74c3c';
            } catch (error) {
                result.textContent = 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message;
                result.style.color = '#e74c3c';
            }
        }
    </script>
</body>
</html>
