<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>未来阶段费用显示测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>🧪 未来阶段费用显示修复测试</h1>
    
    <div class="test-container">
        <h2>📋 测试目标</h2>
        <div class="result info">
            <strong>验证修复：</strong>选择未来阶段的教育水平后，费用汇总和详情应该立即显示<br>
            <strong>测试路径：</strong>幼儿园 → 小学 → 初中 → 高中<br>
            <strong>预期结果：</strong>选择高中教育水平后，立即显示对应的费用信息
        </div>
    </div>

    <div class="test-container">
        <h2>🎯 测试步骤</h2>
        <ol>
            <li><strong>填写基础信息：</strong>幼儿园 → 大班 → 公立 → 北京 → 平衡</li>
            <li><strong>点击开始：</strong>应该显示幼儿园费用和未来阶段卡片</li>
            <li><strong>选择高中教育水平：</strong>在高中卡片中选择"国内公立高中"</li>
            <li><strong>验证结果：</strong>应该立即显示高中费用汇总和详情</li>
            <li><strong>切换教育风格：</strong>将高中教育风格改为"鸡娃"</li>
            <li><strong>验证更新：</strong>补课费应该从47,500变为115,000</li>
        </ol>
        
        <button onclick="runAutomatedTest()">🤖 运行自动化测试</button>
        <button onclick="openMainPage()">🌐 打开主页面</button>
        <button onclick="checkConsoleErrors()">🔍 检查控制台错误</button>
        
        <div id="testResults"></div>
    </div>

    <div class="test-container">
        <h2>🖥️ 嵌入式测试页面</h2>
        <iframe src="index.html" id="testFrame"></iframe>
    </div>

    <script>
        function addResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = message;
            resultsDiv.appendChild(resultDiv);
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
        }

        function openMainPage() {
            window.open('index.html', '_blank');
        }

        function runAutomatedTest() {
            clearResults();
            addResult('🚀 开始自动化测试...', 'info');
            
            const frame = document.getElementById('testFrame');
            
            try {
                const frameDoc = frame.contentDocument || frame.contentWindow.document;
                
                // 等待页面加载
                setTimeout(() => {
                    try {
                        // 步骤1：填写基础信息
                        addResult('📝 步骤1：填写基础信息', 'info');
                        const stage = frameDoc.getElementById('currentStage');
                        const grade = frameDoc.getElementById('currentGrade');
                        const level = frameDoc.getElementById('currentLevel');
                        const city = frameDoc.getElementById('currentCity');
                        const educationStyle = frameDoc.getElementById('educationStyle');
                        
                        if (stage && grade && level && city && educationStyle) {
                            stage.value = 'kindergarten';
                            stage.dispatchEvent(new Event('change'));
                            
                            setTimeout(() => {
                                grade.value = 'senior';
                                grade.dispatchEvent(new Event('change'));
                                
                                level.value = 'public';
                                level.dispatchEvent(new Event('change'));
                                
                                city.value = 'beijing';
                                city.dispatchEvent(new Event('change'));
                                
                                educationStyle.value = 'balanced';
                                educationStyle.dispatchEvent(new Event('change'));
                                
                                addResult('✅ 基础信息填写完成', 'success');
                                
                                // 步骤2：点击开始按钮
                                setTimeout(() => {
                                    const startBtn = frameDoc.getElementById('startPlanning');
                                    if (startBtn && !startBtn.disabled) {
                                        addResult('📝 步骤2：点击开始按钮', 'info');
                                        startBtn.click();
                                        
                                        // 步骤3：检查未来阶段卡片
                                        setTimeout(() => {
                                            const highSchoolCard = frameDoc.querySelector('[id*="high"]');
                                            if (highSchoolCard) {
                                                addResult('✅ 找到高中阶段卡片', 'success');
                                                
                                                // 步骤4：选择高中教育水平
                                                const highSchoolLevel = frameDoc.getElementById('level-high');
                                                if (highSchoolLevel) {
                                                    addResult('📝 步骤4：选择高中教育水平', 'info');
                                                    highSchoolLevel.value = 'domesticPublic';
                                                    highSchoolLevel.dispatchEvent(new Event('change'));
                                                    
                                                    // 步骤5：检查费用显示
                                                    setTimeout(() => {
                                                        const costSummary = frameDoc.getElementById('costSummary-high');
                                                        const costDetails = frameDoc.getElementById('costDetails-high');
                                                        
                                                        if (costSummary && !costSummary.classList.contains('hidden')) {
                                                            addResult('✅ 高中费用汇总显示正常', 'success');
                                                        } else {
                                                            addResult('❌ 高中费用汇总未显示', 'error');
                                                        }
                                                        
                                                        if (costDetails && !costDetails.classList.contains('hidden')) {
                                                            addResult('✅ 高中费用详情显示正常', 'success');
                                                        } else {
                                                            addResult('❌ 高中费用详情未显示', 'error');
                                                        }
                                                        
                                                        // 步骤6：测试教育风格切换
                                                        const educationStyleSelect = frameDoc.getElementById('educationStyle-high');
                                                        if (educationStyleSelect) {
                                                            addResult('📝 步骤6：测试教育风格切换', 'info');
                                                            educationStyleSelect.value = 'intensive';
                                                            educationStyleSelect.dispatchEvent(new Event('change'));
                                                            
                                                            setTimeout(() => {
                                                                addResult('🎉 自动化测试完成！请查看上方结果', 'success');
                                                            }, 1000);
                                                        } else {
                                                            addResult('❌ 未找到高中教育风格选择器', 'error');
                                                        }
                                                    }, 1000);
                                                } else {
                                                    addResult('❌ 未找到高中教育水平选择器', 'error');
                                                }
                                            } else {
                                                addResult('❌ 未找到高中阶段卡片', 'error');
                                            }
                                        }, 2000);
                                    } else {
                                        addResult('❌ 开始按钮不可用或不存在', 'error');
                                    }
                                }, 500);
                            }, 500);
                        } else {
                            addResult('❌ 基础信息表单元素缺失', 'error');
                        }
                    } catch (error) {
                        addResult(`❌ 测试执行错误: ${error.message}`, 'error');
                    }
                }, 2000);
                
            } catch (error) {
                addResult(`❌ 无法访问iframe内容: ${error.message}`, 'error');
                addResult('💡 请手动在新窗口中进行测试', 'info');
            }
        }

        function checkConsoleErrors() {
            clearResults();
            addResult('🔍 请在浏览器开发者工具的Console标签页中检查是否有错误信息', 'info');
            addResult('常见错误类型：', 'info');
            addResult('• TypeError: Cannot read properties of undefined', 'info');
            addResult('• ReferenceError: function is not defined', 'info');
            addResult('• 数据加载失败相关错误', 'info');
        }

        // 页面加载完成后的提示
        window.addEventListener('load', () => {
            setTimeout(() => {
                addResult('💡 页面加载完成，可以开始测试', 'success');
                addResult('建议先运行自动化测试，然后在新窗口中手动验证', 'info');
            }, 1000);
        });
    </script>
</body>
</html>