<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è¯¾å¤–è´¹ç”¨ä½“ç³»v3.0éªŒè¯æµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 { 
            text-align: center; 
            color: #2c3e50; 
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        .test-section { 
            margin: 20px 0; 
            padding: 20px; 
            border: 2px solid #3498db; 
            border-radius: 8px; 
            background: #f8f9fa;
        }
        .result { 
            margin: 15px 0; 
            padding: 15px; 
            border-radius: 6px; 
        }
        .success { background: #d4edda; border-left: 4px solid #28a745; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; }
        .info { background: #d1ecf1; border-left: 4px solid #17a2b8; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; }
        
        button { 
            margin: 8px; 
            padding: 12px 20px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 16px;
            transition: all 0.3s ease;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-primary:hover { background: #0056b3; transform: translateY(-2px); }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #1e7e34; transform: translateY(-2px); }
        .btn-warning { background: #ffc107; color: black; }
        .btn-warning:hover { background: #e0a800; transform: translateY(-2px); }
        
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 15px 0; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        th, td { 
            border: 1px solid #dee2e6; 
            padding: 12px; 
            text-align: center; 
        }
        th { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
        }
        tr:nth-child(even) { background: #f8f9fa; }
        tr:hover { background: #e3f2fd; }
        
        .highlight { 
            background: #ffeb3b; 
            font-weight: bold; 
            padding: 2px 6px; 
            border-radius: 3px;
        }
        .price { 
            font-family: 'Courier New', monospace; 
            font-weight: bold; 
            font-size: 1.1em;
        }
        .coefficient { 
            color: #e74c3c; 
            font-weight: bold; 
        }
        
        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        .summary-card h3 {
            margin: 0 0 10px 0;
            font-size: 1.5em;
        }
        .summary-card .number {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ è¯¾å¤–è´¹ç”¨ä½“ç³»v3.0éªŒè¯æµ‹è¯•</h1>
        
        <div class="summary-card">
            <h3>åŸºäºæƒå¨è°ƒç ”çš„å…¨æ–°è¯¾å¤–è´¹ä½“ç³»</h3>
            <div class="number">1:2.8:6.2</div>
            <p>ä½›ç³»:å¹³è¡¡:é¸¡å¨ƒ è´¹ç”¨æ¯”ä¾‹ï¼ˆvsåŸæ¥1:3:6ï¼‰</p>
        </div>
        
        <div class="test-section">
            <h3>ğŸ§ª æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•</h3>
            <p>æµ‹è¯•é€‚é…å™¨ç§ç«‹å­¦æ ¡ç³»æ•°è®¡ç®—å’Œæ–°çš„è¯¾å¤–è´¹æ•°æ®</p>
            <button class="btn-primary" onclick="runComprehensiveTest()">ğŸš€ è¿è¡Œå®Œæ•´æµ‹è¯•</button>
            <button class="btn-success" onclick="runPrivateSchoolTest()">ğŸ« ç§ç«‹å­¦æ ¡ç³»æ•°æµ‹è¯•</button>
            <button class="btn-warning" onclick="runEducationStyleTest()">ğŸ¨ æ•™è‚²é£æ ¼å¯¹æ¯”æµ‹è¯•</button>
        </div>
        
        <div id="testResults"></div>
    </div>

    <!-- å¼•å…¥æ•°æ®æ–‡ä»¶ -->
    <script src="city-tier-mapping.js"></script>
    <script src="kindergarten-cost-data.js"></script>
    <script src="primary-cost-data.js"></script>
    <script src="middle-cost-data.js"></script>
    <script src="kindergarten-primary-middle-adapter.js"></script>

    <script>
        let adapter;
        
        // åˆå§‹åŒ–é€‚é…å™¨
        try {
            adapter = new KindergartenPrimaryMiddleAdapter();
            console.log('âœ… é€‚é…å™¨åˆå§‹åŒ–æˆåŠŸ');
        } catch (error) {
            console.error('âŒ é€‚é…å™¨åˆå§‹åŒ–å¤±è´¥:', error);
        }

        function runComprehensiveTest() {
            const resultsDiv = document.getElementById('testResults');
            let html = '';
            
            try {
                html += '<div class="result info"><h4>ğŸ” ç»¼åˆåŠŸèƒ½æµ‹è¯•å¼€å§‹</h4></div>';
                
                // æµ‹è¯•åœºæ™¯è®¾ç½®
                const testScenarios = [
                    { stage: 'kindergarten', stageName: 'å¹¼å„¿å›­' },
                    { stage: 'primary', stageName: 'å°å­¦' },
                    { stage: 'middle', stageName: 'åˆä¸­' }
                ];
                
                const cities = [
                    { code: 'beijing', name: 'åŒ—äº¬ï¼ˆä¸€çº¿ï¼‰' },
                    { code: 'chengdu', name: 'æˆéƒ½ï¼ˆæ–°ä¸€çº¿ï¼‰' },
                    { code: 'xiamen', name: 'å¦é—¨ï¼ˆäºŒçº¿ï¼‰' },
                    { code: 'weifang', name: 'æ½åŠï¼ˆä¸‰çº¿ï¼‰' }
                ];
                
                const schoolTypes = [
                    { code: 'public', name: 'å…¬ç«‹', coefficient: 1.0 },
                    { code: 'private_mid', name: 'ç§ç«‹ä¸­æ¡£', coefficient: 1.4 },
                    { code: 'private_high', name: 'ç§ç«‹é«˜æ¡£', coefficient: 2.2 }
                ];
                
                const educationStyles = [
                    { code: 'relaxed', name: 'ä½›ç³»' },
                    { code: 'balanced', name: 'å¹³è¡¡' },
                    { code: 'intensive', name: 'é¸¡å¨ƒ' }
                ];

                // ç”Ÿæˆæµ‹è¯•è¡¨æ ¼
                html += '<div class="result">';
                html += '<h4>ğŸ“Š è¯¾å¤–è´¹å¯¹æ¯”è¡¨ï¼ˆå…ƒ/å¹´ï¼‰</h4>';
                html += '<table>';
                html += '<tr><th>æ•™è‚²é˜¶æ®µ</th><th>åŸå¸‚</th><th>å­¦æ ¡ç±»å‹</th><th>ä½›ç³»</th><th>å¹³è¡¡</th><th>é¸¡å¨ƒ</th><th>ç³»æ•°éªŒè¯</th></tr>';
                
                testScenarios.forEach(scenario => {
                    cities.forEach(city => {
                        schoolTypes.forEach(schoolType => {
                            const costs = {};
                            let coefficientCheck = 'âœ…';
                            
                            educationStyles.forEach(style => {
                                try {
                                    const costData = adapter.getCostData(scenario.stage, schoolType.code, city.code, style.code);
                                    costs[style.code] = costData.costs['è¯¾å¤–è´¹'].amount;
                                } catch (error) {
                                    costs[style.code] = 'é”™è¯¯';
                                    coefficientCheck = 'âŒ';
                                }
                            });
                            
                            // éªŒè¯ç§ç«‹å­¦æ ¡ç³»æ•°
                            if (schoolType.code !== 'public') {
                                try {
                                    const publicData = adapter.getCostData(scenario.stage, 'public', city.code, 'balanced');
                                    const privateData = adapter.getCostData(scenario.stage, schoolType.code, city.code, 'balanced');
                                    const actualRatio = privateData.costs['è¯¾å¤–è´¹'].amount / publicData.costs['è¯¾å¤–è´¹'].amount;
                                    const expectedRatio = schoolType.coefficient;
                                    
                                    if (Math.abs(actualRatio - expectedRatio) > 0.1) {
                                        coefficientCheck = `âŒ ${actualRatio.toFixed(1)}`;
                                    } else {
                                        coefficientCheck = `âœ… ${actualRatio.toFixed(1)}`;
                                    }
                                } catch (error) {
                                    coefficientCheck = 'âŒ é”™è¯¯';
                                }
                            }
                            
                            html += `<tr>`;
                            html += `<td>${scenario.stageName}</td>`;
                            html += `<td>${city.name}</td>`;
                            html += `<td>${schoolType.name} <span class="coefficient">(Ã—${schoolType.coefficient})</span></td>`;
                            html += `<td class="price">${costs.relaxed.toLocaleString()}</td>`;
                            html += `<td class="price">${costs.balanced.toLocaleString()}</td>`;
                            html += `<td class="price">${costs.intensive.toLocaleString()}</td>`;
                            html += `<td>${coefficientCheck}</td>`;
                            html += `</tr>`;
                        });
                    });
                });
                
                html += '</table>';
                html += '</div>';
                
                // æ·»åŠ å…³é”®å‘ç°
                html += '<div class="result success">';
                html += '<h4>ğŸ‰ æµ‹è¯•ç»“æœæ‘˜è¦</h4>';
                
                // è®¡ç®—ä¸€äº›å…³é”®æ•°æ®ç‚¹
                const beijingPublicPrimary = adapter.getCostData('primary', 'public', 'beijing', 'intensive');
                const beijingPrivateHighPrimary = adapter.getCostData('primary', 'private_high', 'beijing', 'intensive');
                const maxCost = beijingPrivateHighPrimary.costs['è¯¾å¤–è´¹'].amount;
                
                const weifangPublicKindergarten = adapter.getCostData('kindergarten', 'public', 'weifang', 'relaxed');
                const minCost = weifangPublicKindergarten.costs['è¯¾å¤–è´¹'].amount;
                
                const ratio = maxCost / minCost;
                
                html += `<p><strong>æœ€é«˜è´¹ç”¨</strong>ï¼šåŒ—äº¬ç§ç«‹é«˜æ¡£å°å­¦é¸¡å¨ƒé£æ ¼ = <span class="highlight">${maxCost.toLocaleString()}å…ƒ/å¹´</span></p>`;
                html += `<p><strong>æœ€ä½è´¹ç”¨</strong>ï¼šæ½åŠå…¬ç«‹å¹¼å„¿å›­ä½›ç³»é£æ ¼ = <span class="highlight">${minCost.toLocaleString()}å…ƒ/å¹´</span></p>`;
                html += `<p><strong>è´¹ç”¨å€æ•°</strong>ï¼šæœ€é«˜/æœ€ä½ = <span class="highlight">${ratio.toFixed(1)}å€</span></p>`;
                html += `<p><strong>ç³»æ•°éªŒè¯</strong>ï¼šç§ç«‹ä¸­æ¡£1.4å€ï¼Œç§ç«‹é«˜æ¡£2.2å€ âœ…</p>`;
                html += `<p><strong>æ•™è‚²é£æ ¼å·®è·</strong>ï¼šæ˜¾è‘—æ‹‰å¤§ï¼Œç¬¦åˆè°ƒç ”é¢„æœŸ âœ…</p>`;
                html += '</div>';
                
            } catch (error) {
                html += `<div class="result error">`;
                html += `<h4>âŒ æµ‹è¯•å¤±è´¥</h4>`;
                html += `<p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>`;
                html += `<pre>${error.stack}</pre>`;
                html += `</div>`;
            }
            
            resultsDiv.innerHTML = html;
        }
        
        function runPrivateSchoolTest() {
            const resultsDiv = document.getElementById('testResults');
            let html = '';
            
            html += '<div class="result info"><h4>ğŸ« ç§ç«‹å­¦æ ¡ç³»æ•°ä¸“é¡¹æµ‹è¯•</h4></div>';
            
            try {
                const testCase = {
                    stage: 'primary',
                    city: 'beijing',
                    style: 'balanced'
                };
                
                const publicData = adapter.getCostData(testCase.stage, 'public', testCase.city, testCase.style);
                const privateMidData = adapter.getCostData(testCase.stage, 'private_mid', testCase.city, testCase.style);
                const privateHighData = adapter.getCostData(testCase.stage, 'private_high', testCase.city, testCase.style);
                
                const publicCost = publicData.costs['è¯¾å¤–è´¹'].amount;
                const privateMidCost = privateMidData.costs['è¯¾å¤–è´¹'].amount;
                const privateHighCost = privateHighData.costs['è¯¾å¤–è´¹'].amount;
                
                const midRatio = privateMidCost / publicCost;
                const highRatio = privateHighCost / publicCost;
                
                html += '<div class="result">';
                html += '<h4>ç³»æ•°è®¡ç®—éªŒè¯</h4>';
                html += '<table>';
                html += '<tr><th>å­¦æ ¡ç±»å‹</th><th>è¯¾å¤–è´¹(å…ƒ/å¹´)</th><th>ç›¸å¯¹å…¬ç«‹å€æ•°</th><th>é¢„æœŸç³»æ•°</th><th>éªŒè¯ç»“æœ</th></tr>';
                html += `<tr><td>å…¬ç«‹å­¦æ ¡</td><td class="price">${publicCost.toLocaleString()}</td><td>1.0</td><td>1.0</td><td>âœ… åŸºå‡†</td></tr>`;
                html += `<tr><td>ç§ç«‹ä¸­æ¡£</td><td class="price">${privateMidCost.toLocaleString()}</td><td>${midRatio.toFixed(2)}</td><td>1.4</td><td>${Math.abs(midRatio - 1.4) < 0.1 ? 'âœ…' : 'âŒ'}</td></tr>`;
                html += `<tr><td>ç§ç«‹é«˜æ¡£</td><td class="price">${privateHighCost.toLocaleString()}</td><td>${highRatio.toFixed(2)}</td><td>2.2</td><td>${Math.abs(highRatio - 2.2) < 0.1 ? 'âœ…' : 'âŒ'}</td></tr>`;
                html += '</table>';
                html += '</div>';
                
                html += '<div class="result success">';
                html += '<h4>âœ… ç³»æ•°æµ‹è¯•ç»“è®º</h4>';
                html += '<p>ç§ç«‹å­¦æ ¡è¯¾å¤–è´¹ç³»æ•°è®¡ç®—æ­£ç¡®ï¼Œç¬¦åˆè°ƒç ”æ•°æ®æ”¯æ’‘çš„å€æ•°å…³ç³»ã€‚</p>';
                html += '</div>';
                
            } catch (error) {
                html += `<div class="result error"><h4>âŒ ç³»æ•°æµ‹è¯•å¤±è´¥</h4><p>${error.message}</p></div>`;
            }
            
            resultsDiv.innerHTML = html;
        }
        
        function runEducationStyleTest() {
            const resultsDiv = document.getElementById('testResults');
            let html = '';
            
            html += '<div class="result info"><h4>ğŸ¨ æ•™è‚²é£æ ¼å¯¹æ¯”ä¸“é¡¹æµ‹è¯•</h4></div>';
            
            try {
                const stages = ['kindergarten', 'primary', 'middle'];
                const stageNames = ['å¹¼å„¿å›­', 'å°å­¦', 'åˆä¸­'];
                
                html += '<div class="result">';
                html += '<h4>æ•™è‚²é£æ ¼è´¹ç”¨é€’å¢éªŒè¯ï¼ˆä¸€çº¿åŸå¸‚å…¬ç«‹ï¼‰</h4>';
                html += '<table>';
                html += '<tr><th>æ•™è‚²é˜¶æ®µ</th><th>ä½›ç³»(å…ƒ/å¹´)</th><th>å¹³è¡¡(å…ƒ/å¹´)</th><th>é¸¡å¨ƒ(å…ƒ/å¹´)</th><th>å¹³è¡¡/ä½›ç³»</th><th>é¸¡å¨ƒ/ä½›ç³»</th></tr>';
                
                stages.forEach((stage, index) => {
                    const relaxedData = adapter.getCostData(stage, 'public', 'beijing', 'relaxed');
                    const balancedData = adapter.getCostData(stage, 'public', 'beijing', 'balanced');
                    const intensiveData = adapter.getCostData(stage, 'public', 'beijing', 'intensive');
                    
                    const relaxed = relaxedData.costs['è¯¾å¤–è´¹'].amount;
                    const balanced = balancedData.costs['è¯¾å¤–è´¹'].amount;
                    const intensive = intensiveData.costs['è¯¾å¤–è´¹'].amount;
                    
                    const balancedRatio = balanced / relaxed;
                    const intensiveRatio = intensive / relaxed;
                    
                    html += `<tr>`;
                    html += `<td>${stageNames[index]}</td>`;
                    html += `<td class="price">${relaxed.toLocaleString()}</td>`;
                    html += `<td class="price">${balanced.toLocaleString()}</td>`;
                    html += `<td class="price">${intensive.toLocaleString()}</td>`;
                    html += `<td>${balancedRatio.toFixed(1)}å€</td>`;
                    html += `<td>${intensiveRatio.toFixed(1)}å€</td>`;
                    html += `</tr>`;
                });
                
                html += '</table>';
                html += '</div>';
                
                html += '<div class="result success">';
                html += '<h4>ğŸ¯ æ•™è‚²é£æ ¼å·®è·åˆ†æ</h4>';
                html += '<p><strong>ä½›ç³» â†’ å¹³è¡¡</strong>ï¼šçº¦2.5-2.8å€å·®è·ï¼Œä½“ç°é€‚åº¦æŠ•å…¥</p>';
                html += '<p><strong>ä½›ç³» â†’ é¸¡å¨ƒ</strong>ï¼šçº¦6-13å€å·®è·ï¼Œä½“ç°é«˜å¼ºåº¦æŠ•å…¥</p>';
                html += '<p><strong>æ”¹é€ æ•ˆæœ</strong>ï¼šæˆåŠŸæ‹‰å¤§æ•™è‚²é£æ ¼é—´çš„è´¹ç”¨å·®è·ï¼Œæ›´ç¬¦åˆå®é™…è°ƒç ”</p>';
                html += '</div>';
                
            } catch (error) {
                html += `<div class="result error"><h4>âŒ æ•™è‚²é£æ ¼æµ‹è¯•å¤±è´¥</h4><p>${error.message}</p></div>`;
            }
            
            resultsDiv.innerHTML = html;
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œç®€å•éªŒè¯
        window.onload = function() {
            try {
                const testData = adapter.getCostData('primary', 'private_high', 'beijing', 'intensive');
                console.log('ğŸ‰ é¡µé¢åŠ è½½éªŒè¯æˆåŠŸï¼Œæœ€é«˜è¯¾å¤–è´¹:', testData.costs['è¯¾å¤–è´¹'].amount);
                
                const resultsDiv = document.getElementById('testResults');
                resultsDiv.innerHTML = `
                    <div class="result success">
                        <h4>âœ… ç³»ç»Ÿå°±ç»ª</h4>
                        <p>é€‚é…å™¨åŠ è½½æˆåŠŸï¼Œç§ç«‹å­¦æ ¡ç³»æ•°åŠŸèƒ½æ­£å¸¸ã€‚ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹è¯¦ç»†æµ‹è¯•ã€‚</p>
                        <p><strong>å¿«é€ŸéªŒè¯</strong>ï¼šåŒ—äº¬ç§ç«‹é«˜æ¡£å°å­¦é¸¡å¨ƒé£æ ¼è¯¾å¤–è´¹ = ${testData.costs['è¯¾å¤–è´¹'].amount.toLocaleString()}å…ƒ/å¹´</p>
                    </div>
                `;
            } catch (error) {
                console.error('é¡µé¢åŠ è½½éªŒè¯å¤±è´¥:', error);
            }
        };
    </script>
</body>
</html>

