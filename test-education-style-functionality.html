<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•™è‚²é£æ ¼åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
        }
        
        .test-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .test-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 16px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
        
        .test-case {
            margin-bottom: 16px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .test-label {
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
        }
        
        .test-result {
            font-family: 'Monaco', 'Menlo', monospace;
            background: #2c3e50;
            color: #ecf0f1;
            padding: 12px;
            border-radius: 6px;
            white-space: pre-wrap;
            margin-top: 8px;
        }
        
        .test-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .test-button:hover {
            background: #2980b9;
        }
        
        .success {
            color: #27ae60;
            font-weight: 600;
        }
        
        .error {
            color: #e74c3c;
            font-weight: 600;
        }
        
        .info {
            color: #3498db;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª æ•™è‚²é£æ ¼åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <div class="test-title">ğŸ“‹ æµ‹è¯•è¯´æ˜</div>
        <p>æœ¬é¡µé¢ç”¨äºæµ‹è¯•æ–°å¢çš„æœªæ¥é˜¶æ®µæ•™è‚²é£æ ¼åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š</p>
        <ul>
            <li><strong>é»˜è®¤å€¼ç»§æ‰¿</strong>ï¼šæœªæ¥é˜¶æ®µæ•™è‚²é£æ ¼é»˜è®¤ç»§æ‰¿åŸºç¡€ä¿¡æ¯çš„é€‰æ‹©</li>
            <li><strong>ç‹¬ç«‹ä¿®æ”¹</strong>ï¼šæ¯ä¸ªæœªæ¥é˜¶æ®µå¯ä»¥ç‹¬ç«‹è®¾ç½®æ•™è‚²é£æ ¼</li>
            <li><strong>è´¹ç”¨è®¡ç®—</strong>ï¼šè´¹ç”¨è®¡ç®—ä½¿ç”¨é˜¶æ®µç‰¹å®šçš„æ•™è‚²é£æ ¼</li>
            <li><strong>è”åŠ¨é‡ç½®</strong>ï¼šåŸºç¡€ä¿¡æ¯æ•™è‚²é£æ ¼å˜åŒ–æ—¶é‡ç½®æ‰€æœ‰æœªæ¥é˜¶æ®µ</li>
        </ul>
    </div>

    <div class="test-section">
        <div class="test-title">ğŸ” 1. æ•°æ®ç»“æ„æµ‹è¯•</div>
        
        <div class="test-case">
            <div class="test-label">æµ‹è¯•ç”¨æˆ·è®¡åˆ’æ•°æ®ç»“æ„</div>
            <button class="test-button" onclick="testUserPlanStructure()">æµ‹è¯•æ•°æ®ç»“æ„</button>
            <div id="userPlanResult" class="test-result"></div>
        </div>
        
        <div class="test-case">
            <div class="test-label">æµ‹è¯•æ•™è‚²é£æ ¼è·å–å‡½æ•°</div>
            <button class="test-button" onclick="testGetStageEducationStyle()">æµ‹è¯•è·å–å‡½æ•°</button>
            <div id="getStyleResult" class="test-result"></div>
        </div>
    </div>

    <div class="test-section">
        <div class="test-title">ğŸ¯ 2. é»˜è®¤å€¼ç»§æ‰¿æµ‹è¯•</div>
        
        <div class="test-case">
            <div class="test-label">æ¨¡æ‹ŸåŸºç¡€ä¿¡æ¯è®¾ç½®</div>
            <button class="test-button" onclick="simulateBasicInfo('relaxed')">è®¾ç½®ä¸ºä½›ç³»</button>
            <button class="test-button" onclick="simulateBasicInfo('balanced')">è®¾ç½®ä¸ºå¹³è¡¡</button>
            <button class="test-button" onclick="simulateBasicInfo('intensive')">è®¾ç½®ä¸ºé¸¡å¨ƒ</button>
            <div id="basicInfoResult" class="test-result"></div>
        </div>
        
        <div class="test-case">
            <div class="test-label">æµ‹è¯•é»˜è®¤å€¼ç»§æ‰¿</div>
            <button class="test-button" onclick="testDefaultInheritance()">æµ‹è¯•ç»§æ‰¿é€»è¾‘</button>
            <div id="inheritanceResult" class="test-result"></div>
        </div>
    </div>

    <div class="test-section">
        <div class="test-title">âš™ï¸ 3. ç‹¬ç«‹ä¿®æ”¹æµ‹è¯•</div>
        
        <div class="test-case">
            <div class="test-label">æµ‹è¯•é˜¶æ®µç‹¬ç«‹è®¾ç½®</div>
            <button class="test-button" onclick="testIndependentSetting()">æµ‹è¯•ç‹¬ç«‹è®¾ç½®</button>
            <div id="independentResult" class="test-result"></div>
        </div>
    </div>

    <div class="test-section">
        <div class="test-title">ğŸ’° 4. è´¹ç”¨è®¡ç®—æµ‹è¯•</div>
        
        <div class="test-case">
            <div class="test-label">æµ‹è¯•å¹¼å°åˆé˜¶æ®µè´¹ç”¨è®¡ç®—</div>
            <button class="test-button" onclick="testKPMCostCalculation()">æµ‹è¯•è´¹ç”¨è®¡ç®—</button>
            <div id="costCalculationResult" class="test-result"></div>
        </div>
    </div>

    <div class="test-section">
        <div class="test-title">ğŸ”„ 5. è”åŠ¨é‡ç½®æµ‹è¯•</div>
        
        <div class="test-case">
            <div class="test-label">æµ‹è¯•åŸºç¡€ä¿¡æ¯å˜åŒ–è”åŠ¨</div>
            <button class="test-button" onclick="testResetLogic()">æµ‹è¯•é‡ç½®é€»è¾‘</button>
            <div id="resetResult" class="test-result"></div>
        </div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„JSæ–‡ä»¶ -->
    <script src="education-stages-config.js"></script>
    <script src="city-tier-mapping.js"></script>
    <script src="kindergarten-cost-data.js"></script>
    <script src="primary-cost-data.js"></script>
    <script src="middle-cost-data.js"></script>
    <script src="kindergarten-primary-middle-adapter.js"></script>

    <script>
        // æ¨¡æ‹Ÿç”¨æˆ·è®¡åˆ’å¯¹è±¡
        let userPlan = {
            currentStage: 'primary',
            currentGrade: 'grade1',
            currentLevel: 'public',
            currentCity: 'beijing',
            currentCountry: '',
            educationStyle: '',
            stageEducationStyles: {}
        };

        // æ¨¡æ‹Ÿé€‚é…å™¨
        let kindergartenPrimaryMiddleAdapter;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            try {
                kindergartenPrimaryMiddleAdapter = new KindergartenPrimaryMiddleAdapter();
                console.log('âœ… é€‚é…å™¨åˆå§‹åŒ–æˆåŠŸ');
            } catch (error) {
                console.error('âŒ é€‚é…å™¨åˆå§‹åŒ–å¤±è´¥:', error);
            }
        });

        // è·å–é˜¶æ®µç‰¹å®šçš„æ•™è‚²é£æ ¼
        function getStageEducationStyle(stageCode) {
            if (userPlan.stageEducationStyles[stageCode]) {
                return userPlan.stageEducationStyles[stageCode];
            }
            return userPlan.educationStyle || 'balanced';
        }

        // è®¾ç½®é˜¶æ®µæ•™è‚²é£æ ¼
        function setStageEducationStyle(stageCode, educationStyle) {
            userPlan.stageEducationStyles[stageCode] = educationStyle;
        }

        // æµ‹è¯•å‡½æ•°
        function testUserPlanStructure() {
            const result = document.getElementById('userPlanResult');
            try {
                const structure = {
                    "userPlanç»“æ„": userPlan,
                    "æ˜¯å¦åŒ…å«stageEducationStyles": 'stageEducationStyles' in userPlan,
                    "stageEducationStylesç±»å‹": typeof userPlan.stageEducationStyles
                };
                result.textContent = JSON.stringify(structure, null, 2);
                result.style.color = '#27ae60';
            } catch (error) {
                result.textContent = 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message;
                result.style.color = '#e74c3c';
            }
        }

        function testGetStageEducationStyle() {
            const result = document.getElementById('getStyleResult');
            try {
                // æµ‹è¯•ä¸åŒåœºæ™¯
                const tests = {
                    "åœºæ™¯1 - æ— åŸºç¡€é£æ ¼ï¼Œæ— é˜¶æ®µè®¾ç½®": getStageEducationStyle('primary'),
                    "åœºæ™¯2 - æœ‰åŸºç¡€é£æ ¼(é¸¡å¨ƒ)ï¼Œæ— é˜¶æ®µè®¾ç½®": (() => {
                        userPlan.educationStyle = 'intensive';
                        return getStageEducationStyle('primary');
                    })(),
                    "åœºæ™¯3 - æœ‰åŸºç¡€é£æ ¼(é¸¡å¨ƒ)ï¼Œæœ‰é˜¶æ®µè®¾ç½®(ä½›ç³»)": (() => {
                        setStageEducationStyle('primary', 'relaxed');
                        return getStageEducationStyle('primary');
                    })(),
                    "åœºæ™¯4 - ä¸åŒé˜¶æ®µ": getStageEducationStyle('middle')
                };
                result.textContent = JSON.stringify(tests, null, 2);
                result.style.color = '#27ae60';
            } catch (error) {
                result.textContent = 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message;
                result.style.color = '#e74c3c';
            }
        }

        function simulateBasicInfo(style) {
            const result = document.getElementById('basicInfoResult');
            try {
                userPlan.educationStyle = style;
                userPlan.stageEducationStyles = {}; // æ¸…ç©ºé˜¶æ®µè®¾ç½®
                
                const info = {
                    "åŸºç¡€æ•™è‚²é£æ ¼": userPlan.educationStyle,
                    "é˜¶æ®µè®¾ç½®": userPlan.stageEducationStyles,
                    "primaryé˜¶æ®µè·å–åˆ°çš„é£æ ¼": getStageEducationStyle('primary'),
                    "middleé˜¶æ®µè·å–åˆ°çš„é£æ ¼": getStageEducationStyle('middle')
                };
                result.textContent = JSON.stringify(info, null, 2);
                result.style.color = '#3498db';
            } catch (error) {
                result.textContent = 'âŒ æ¨¡æ‹Ÿå¤±è´¥: ' + error.message;
                result.style.color = '#e74c3c';
            }
        }

        function testDefaultInheritance() {
            const result = document.getElementById('inheritanceResult');
            try {
                // è®¾ç½®åŸºç¡€é£æ ¼ä¸ºå¹³è¡¡
                userPlan.educationStyle = 'balanced';
                userPlan.stageEducationStyles = {};
                
                const tests = {
                    "åŸºç¡€é£æ ¼": userPlan.educationStyle,
                    "primaryç»§æ‰¿": getStageEducationStyle('primary'),
                    "middleç»§æ‰¿": getStageEducationStyle('middle'),
                    "kindergartenç»§æ‰¿": getStageEducationStyle('kindergarten'),
                    "high_schoolç»§æ‰¿": getStageEducationStyle('high_school')
                };
                
                const success = tests.primaryç»§æ‰¿ === 'balanced' && 
                              tests.middleç»§æ‰¿ === 'balanced' && 
                              tests.kindergartenç»§æ‰¿ === 'balanced';
                
                result.textContent = JSON.stringify({
                    "æµ‹è¯•ç»“æœ": success ? "âœ… ç»§æ‰¿æˆåŠŸ" : "âŒ ç»§æ‰¿å¤±è´¥",
                    "è¯¦ç»†æ•°æ®": tests
                }, null, 2);
                result.style.color = success ? '#27ae60' : '#e74c3c';
            } catch (error) {
                result.textContent = 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message;
                result.style.color = '#e74c3c';
            }
        }

        function testIndependentSetting() {
            const result = document.getElementById('independentResult');
            try {
                // è®¾ç½®åŸºç¡€é£æ ¼
                userPlan.educationStyle = 'balanced';
                userPlan.stageEducationStyles = {};
                
                // ç‹¬ç«‹è®¾ç½®ä¸åŒé˜¶æ®µ
                setStageEducationStyle('primary', 'intensive');
                setStageEducationStyle('middle', 'relaxed');
                
                const tests = {
                    "åŸºç¡€é£æ ¼": userPlan.educationStyle,
                    "primaryç‹¬ç«‹è®¾ç½®": getStageEducationStyle('primary'),
                    "middleç‹¬ç«‹è®¾ç½®": getStageEducationStyle('middle'),
                    "kindergartenä½¿ç”¨é»˜è®¤": getStageEducationStyle('kindergarten'),
                    "å†…éƒ¨å­˜å‚¨": userPlan.stageEducationStyles
                };
                
                const success = tests.primaryç‹¬ç«‹è®¾ç½® === 'intensive' && 
                              tests.middleç‹¬ç«‹è®¾ç½® === 'relaxed' && 
                              tests.kindergartenä½¿ç”¨é»˜è®¤ === 'balanced';
                
                result.textContent = JSON.stringify({
                    "æµ‹è¯•ç»“æœ": success ? "âœ… ç‹¬ç«‹è®¾ç½®æˆåŠŸ" : "âŒ ç‹¬ç«‹è®¾ç½®å¤±è´¥",
                    "è¯¦ç»†æ•°æ®": tests
                }, null, 2);
                result.style.color = success ? '#27ae60' : '#e74c3c';
            } catch (error) {
                result.textContent = 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message;
                result.style.color = '#e74c3c';
            }
        }

        function testKPMCostCalculation() {
            const result = document.getElementById('costCalculationResult');
            try {
                if (!kindergartenPrimaryMiddleAdapter) {
                    throw new Error('é€‚é…å™¨æœªåˆå§‹åŒ–');
                }
                
                // æµ‹è¯•ä¸åŒæ•™è‚²é£æ ¼çš„è´¹ç”¨è®¡ç®—
                const tests = {};
                
                ['relaxed', 'balanced', 'intensive'].forEach(style => {
                    try {
                        const costData = kindergartenPrimaryMiddleAdapter.getCostData(
                            'primary',
                            'public',
                            'beijing',
                            style
                        );
                        
                        tests[`å°å­¦å…¬ç«‹åŒ—äº¬${style}`] = {
                            "æ•™è‚²é£æ ¼": costData.educationStyle,
                            "è¯¾å¤–è´¹": costData.costs.è¯¾å¤–è´¹.amount,
                            "æ•°æ®æº": costData.dataSource
                        };
                    } catch (error) {
                        tests[`å°å­¦å…¬ç«‹åŒ—äº¬${style}`] = "âŒ " + error.message;
                    }
                });
                
                result.textContent = JSON.stringify(tests, null, 2);
                result.style.color = '#27ae60';
            } catch (error) {
                result.textContent = 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message;
                result.style.color = '#e74c3c';
            }
        }

        function testResetLogic() {
            const result = document.getElementById('resetResult');
            try {
                // æ¨¡æ‹Ÿåœºæ™¯ï¼šå…ˆè®¾ç½®åŸºç¡€é£æ ¼å’Œç‹¬ç«‹é˜¶æ®µé£æ ¼
                userPlan.educationStyle = 'balanced';
                setStageEducationStyle('primary', 'intensive');
                setStageEducationStyle('middle', 'relaxed');
                
                const beforeReset = {
                    "åŸºç¡€é£æ ¼": userPlan.educationStyle,
                    "primaryé£æ ¼": getStageEducationStyle('primary'),
                    "middleé£æ ¼": getStageEducationStyle('middle'),
                    "é˜¶æ®µè®¾ç½®": {...userPlan.stageEducationStyles}
                };
                
                // æ¨¡æ‹ŸåŸºç¡€é£æ ¼å˜åŒ–ä¸ºé¸¡å¨ƒ
                userPlan.educationStyle = 'intensive';
                userPlan.stageEducationStyles = {}; // æ¨¡æ‹Ÿé‡ç½®
                
                const afterReset = {
                    "åŸºç¡€é£æ ¼": userPlan.educationStyle,
                    "primaryé£æ ¼": getStageEducationStyle('primary'),
                    "middleé£æ ¼": getStageEducationStyle('middle'),
                    "é˜¶æ®µè®¾ç½®": {...userPlan.stageEducationStyles}
                };
                
                const success = afterReset.primaryé£æ ¼ === 'intensive' && 
                              afterReset.middleé£æ ¼ === 'intensive' && 
                              Object.keys(afterReset.é˜¶æ®µè®¾ç½®).length === 0;
                
                result.textContent = JSON.stringify({
                    "æµ‹è¯•ç»“æœ": success ? "âœ… é‡ç½®é€»è¾‘æ­£ç¡®" : "âŒ é‡ç½®é€»è¾‘é”™è¯¯",
                    "é‡ç½®å‰": beforeReset,
                    "é‡ç½®å": afterReset
                }, null, 2);
                result.style.color = success ? '#27ae60' : '#e74c3c';
            } catch (error) {
                result.textContent = 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message;
                result.style.color = '#e74c3c';
            }
        }
    </script>
</body>
</html>
